# **Sincroniza√ß√£o de Dados CSV com Supabase**

Este projeto implementa um servi√ßo em Python para sincronizar dados de um arquivo CSV com tabelas em um banco de dados Supabase. Ele foi projetado para evitar duplica√ß√£o de dados e permite a configura√ß√£o din√¢mica de caminho do arquivo, credenciais do banco e intervalo de sincroniza√ß√£o.

---

## **Recursos**
- Leitura de arquivos CSV com suporte a diferentes codifica√ß√µes.
- Detec√ß√£o de duplicatas antes da inser√ß√£o no banco.
- Sincroniza√ß√£o de dados com as tabelas:
  - `cliente`
  - `contrato`
  - `produto`
- Logs detalhados para monitorar a execu√ß√£o e depurar problemas.
- Configura√ß√£o din√¢mica via arquivo `config.json`.

---

## **Instala√ß√£o**

### **Pr√©-requisitos**
- **Python 3.8+**
- Instale as depend√™ncias do projeto:
  ```bash
  pip install -r requirements.txt
  ```

### **Configura√ß√£o**
1. **Configurar o arquivo `config.json`**:
   Crie um arquivo `config.json` com o seguinte formato:
   ```json
   {
       "update_interval_minutes": 60,
       "csv_file_path": "path/to/your/file.csv",
       "supabase_url": "https://seu-supabase-url.supabase.co",
       "supabase_anon_key": "sua-chave-anon",
       "supabase_service_role_key": "sua-chave-service-role"
   }
   ```
   - **`update_interval_minutes`**: Intervalo de execu√ß√£o da sincroniza√ß√£o, em minutos.
   - **`csv_file_path`**: Caminho absoluto do arquivo CSV.
   - **`supabase_url`**: URL do seu projeto Supabase.
   - **`supabase_anon_key`** e **`supabase_service_role_key`**: Chaves de autentica√ß√£o do Supabase.

2. **Configurar vari√°veis de ambiente (opcional)**:
   Em vez de usar `config.json`, voc√™ pode definir as chaves diretamente no ambiente:
   ```bash
   export SUPABASE_URL="https://seu-supabase-url.supabase.co"
   export SUPABASE_ANON_KEY="sua-chave-anon"
   export SUPABASE_SERVICE_ROLE_KEY="sua-chave-service-role"
   ```

---

## **Uso**

### **Executar o Servi√ßo**
1. Execute o script principal:
   ```bash
   python service.py
   ```
2. O servi√ßo sincronizar√° automaticamente os dados com o Supabase no intervalo configurado.

---

## **Estrutura do Projeto**

```plaintext
.
‚îú‚îÄ‚îÄ service.py            # Script principal
‚îú‚îÄ‚îÄ config.json           # Configura√ß√µes do sistema (adicionado pelo usu√°rio)
‚îú‚îÄ‚îÄ requirements.txt      # Depend√™ncias do projeto
‚îú‚îÄ‚îÄ service.log           # Arquivo de logs gerado automaticamente
‚îî‚îÄ‚îÄ README.md             # Este arquivo
```

---

## **Tabelas no Supabase**

### **Tabela: `cliente`**
| Campo               | Tipo       | Descri√ß√£o                   |
|---------------------|------------|-----------------------------|
| `id_siger_cliente`  | `bigint`   | ID do cliente no SIGER      |
| `nome_cliente`      | `text`     | Nome do cliente             |
| `cnpj`              | `text`     | CNPJ do cliente             |
| `deletado`          | `boolean`  | Status de exclus√£o l√≥gica   |

### **Tabela: `contrato`**
| Campo               | Tipo       | Descri√ß√£o                   |
|---------------------|------------|-----------------------------|
| `id_contrato`       | `integer`  | ID do contrato no SIGER     |
| `id_siger_cliente`  | `bigint`   | Relacionado ao cliente      |
| `dt_inic_cont`      | `date`     | Data de in√≠cio do contrato  |
| `dt_vig_inic`       | `date`     | Data de in√≠cio da vig√™ncia  |
| `dt_vig_final`      | `date`     | Data de t√©rmino da vig√™ncia |
| `deletado`          | `boolean`  | Status de exclus√£o l√≥gica   |

### **Tabela: `produto`**
| Campo               | Tipo       | Descri√ß√£o                   |
|---------------------|------------|-----------------------------|
| `id_produto_siger`  | `bigint`   | ID do produto no SIGER      |
| `nome_produto`      | `text`     | Nome do produto             |
| `tipo_produto`      | `text`     | Tipo do produto             |
| `id_cliente_siger`  | `bigint`   | Relacionado ao cliente      |
| `id_contrato`       | `integer`  | Relacionado ao contrato     |
| `num_serie`         | `text`     | N√∫mero de s√©rie (opcional)  |
| `num_lote`          | `text`     | N√∫mero do lote (opcional)   |
| `deletado`          | `boolean`  | Status de exclus√£o l√≥gica   |

---

## **Logs**

- Os logs s√£o armazenados no arquivo `service.log` e incluem informa√ß√µes como:
  - Detec√ß√£o de codifica√ß√£o do CSV.
  - Inser√ß√µes bem-sucedidas no banco.
  - Detec√ß√£o de duplicatas.
  - Erros e exce√ß√µes.

### Exemplo de Log
```plaintext
2025-01-10 15:00:00 [INFO] Servi√ßo iniciado. Atualiza√ß√£o programada a cada 60 minutos.
2025-01-10 15:00:01 [INFO] Carregando arquivo de configura√ß√£o.
2025-01-10 15:00:02 [INFO] Conectando ao Supabase.
2025-01-10 15:00:03 [INFO] Lendo dados do arquivo CSV: /path/to/file.csv
2025-01-10 15:00:03 [INFO] Carregados 4554 registros do CSV.
2025-01-10 15:00:04 [INFO] Sincronizando clientes.
2025-01-10 15:00:05 [INFO] Cliente inserido: {'id_siger_cliente': 1, 'nome_cliente': 'Cliente A', 'cnpj': '12345678901234'}
```

---

## **Contribui√ß√£o**

1. Fa√ßa um fork do reposit√≥rio.
2. Crie um branch para a sua feature/corre√ß√£o:
   ```bash
   git checkout -b minha-feature
   ```
3. Fa√ßa as altera√ß√µes e envie um pull request.

---

## **Licen√ßa**

Este projeto est√° licenciado sob a licen√ßa MIT. Consulte o arquivo `LICENSE` para mais informa√ß√µes.

---

### Se precisar de mais ajustes ou algum outro conte√∫do no README, √© s√≥ avisar! üòä
